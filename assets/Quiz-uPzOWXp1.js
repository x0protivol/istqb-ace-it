import{j as e}from"./ui-DfBBc6NZ.js";import{r as s}from"./vendor-CKBrVor4.js";import{C as t,d as a,e as r,T as i,f as n,P as l,a as o,B as c,b as d}from"./badge-D-2uMhcz.js";import{c as m,u,s as x,a as h}from"./index-BqW154GX.js";import{b as f}from"./router-P2so4x_Y.js";import"./supabase-qmzs_Ol3.js";
/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const p=m("ChevronLeft",[["path",{d:"m15 18-6-6 6-6",key:"1wnfg3"}]]),j=m("ChevronRight",[["path",{d:"m9 18 6-6-6-6",key:"mthhwq"}]]),g=m("Lightbulb",[["path",{d:"M15 14c.2-1 .7-1.7 1.5-2.5 1-.9 1.5-2.2 1.5-3.5A6 6 0 0 0 6 8c0 1 .2 2.2 1.5 3.5.7.7 1.3 1.5 1.5 2.5",key:"1gvzjb"}],["path",{d:"M9 18h6",key:"x1upvd"}],["path",{d:"M10 22h4",key:"ceow96"}]]),w=m("TriangleAlert",[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3",key:"wmoenq"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]]),v=()=>{const m=f();u();const{examSession:v,examQuestions:y,loading:N,startExam:b,updateAnswer:_,finishExam:S}=(()=>{const[e,t]=s.useState(null),[a,r]=s.useState([]),[i,n]=s.useState(!1),{toast:l}=u(),o=async(e,s,t)=>{try{const{data:a}=await x.from("user_stats").select("*").limit(1).single(),r=Math.floor(t/s);if(a){const t=a.total_questions+s,i=a.correct_answers+e,n=a.total_points+e,l=a.exams_taken+1,{error:o}=await x.from("user_stats").update({total_questions:t,correct_answers:i,total_points:n,exams_taken:l,average_time:Math.floor((a.average_time+r)/2),last_exam_date:(new Date).toISOString()}).eq("id",a.id);if(o)throw o}else{const{error:t}=await x.from("user_stats").insert({total_questions:s,correct_answers:e,total_points:e,current_streak:0,best_streak:0,average_time:r,exams_taken:1,last_exam_date:(new Date).toISOString()});if(t)throw t}}catch(a){console.error("Error updating user stats:",a)}};return{examSession:e,examQuestions:a,loading:i,startExam:async(e=60)=>{try{let a,i;n(!0);let o=0;const c=3;for(;o<c;)try{const s=await x.from("questions").select("*").limit(e);if(a=s.data,i=s.error,!i)break;o++,o<c&&await new Promise(e=>setTimeout(e,1e3*o))}catch(s){if(o++,o>=c)throw s;await new Promise(e=>setTimeout(e,1e3*o))}if(i)throw i;if(!a||0===a.length)return l({title:"No Questions Available",description:"Please upload some questions first",variant:"destructive"}),null;const d=[...a].sort(()=>Math.random()-.5),m={question_ids:d.map(e=>e.id),answers:new Array(d.length).fill(-1),score:0,time_spent:0,total_time:60*e,completed:!1,started_at:(new Date).toISOString()},{data:u,error:h}=await x.from("exam_sessions").insert(m).select().single();if(h)throw h;return t(u),r(d),l({title:"Exam Started",description:`Good luck with your ${e} question exam!`}),u}catch(s){return console.error("Error starting exam:",s),l({title:"Error",description:"Failed to start exam",variant:"destructive"}),null}finally{n(!1)}},updateAnswer:async(s,a)=>{if(e)try{const r=[...e.answers];r[s]=a;const{error:i}=await x.from("exam_sessions").update({answers:r}).eq("id",e.id);if(i)throw i;t(e=>e?{...e,answers:r}:null)}catch(r){console.error("Error updating answer:",r)}},finishExam:async s=>{if(!e||!a)return null;try{let r=0;e.answers.forEach((e,s)=>{e===a[s].correct_answer&&(r+=1)});const i={...e,score:r,time_spent:s,completed:!0,completed_at:(new Date).toISOString()},{error:n}=await x.from("exam_sessions").update({score:i.score,time_spent:i.time_spent,completed:!0,completed_at:i.completed_at}).eq("id",e.id);if(n)throw n;return await o(r,a.length,s),t(i),i}catch(r){return console.error("Error finishing exam:",r),l({title:"Error",description:"Failed to save exam results",variant:"destructive"}),null}}}})(),[k,E]=s.useState(0),[q,C]=s.useState(null),[M,A]=s.useState(!1),[D,P]=s.useState(!1),[T,F]=s.useState(0),[I,Q]=s.useState(0),[O,z]=s.useState(!1);s.useEffect(()=>{O||v||L()},[]);const L=async()=>{const e=await b(60);e?(F(e.total_time),Q(Date.now()),z(!0)):m("/")};s.useEffect(()=>{if(v&&k<v.answers.length){const e=v.answers[k];C(e>=0?e:null)}},[k,v]),s.useEffect(()=>{if(T>0&&O){const e=setTimeout(()=>F(T-1),1e3);return()=>clearTimeout(e)}0===T&&O&&$()},[T,O]);const $=async()=>{if(!v)return;const e=Math.floor((Date.now()-I)/1e3),s=await S(e);s&&(localStorage.setItem("examResults",JSON.stringify({session:s,questions:y})),m("/results"))};if(N||!v||0===y.length)return e.jsx("div",{className:"min-h-screen bg-background p-6 flex items-center justify-center",children:e.jsx(t,{className:"w-full max-w-md",children:e.jsx(a,{className:"pt-6 text-center space-y-4",children:N?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary mx-auto"}),e.jsx("p",{children:"Setting up your exam..."})]}):e.jsxs(e.Fragment,{children:[e.jsx(w,{className:"h-8 w-8 text-warning mx-auto"}),e.jsx("p",{children:"No questions available. Please upload questions first."}),e.jsx(r,{onClick:()=>m("/"),children:"Go to Dashboard"})]})})})});const B=(k+1)/y.length*100,G=y[k],H=T<300;return e.jsx("div",{className:"min-h-screen bg-background p-6",children:e.jsxs("div",{className:"max-w-4xl mx-auto space-y-6",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold",children:"ISTQB Practice Exam"}),e.jsx("p",{className:"text-muted-foreground",children:"Foundation Level Certification"})]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"flex items-center gap-2 text-primary",children:[e.jsx(i,{className:"h-5 w-5"}),e.jsxs("span",{className:"font-semibold",children:["Question ",k+1]})]}),e.jsxs("div",{className:"flex items-center gap-2 "+(H?"text-destructive animate-pulse":"text-muted-foreground"),children:[e.jsx(n,{className:"h-5 w-5"}),e.jsx("span",{className:"font-semibold",children:(R=T,`${Math.floor(R/60)}:${(R%60).toString().padStart(2,"0")}`)})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsxs("span",{children:["Question ",k+1," of ",y.length]}),e.jsxs("span",{children:[Math.round(B),"% Complete"]})]}),e.jsx(l,{value:B,className:"h-3"}),H&&e.jsx("div",{className:"text-sm text-destructive font-medium",children:"⚠️ Less than 5 minutes remaining!"})]}),e.jsxs(t,{className:"shadow-quiz",children:[e.jsxs(o,{children:[e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(c,{variant:"secondary",children:G.category}),e.jsx(c,{variant:"Easy"===G.difficulty?"default":"Medium"===G.difficulty?"secondary":"destructive",children:G.difficulty})]}),e.jsx(d,{className:"text-lg leading-relaxed",children:G.question})]}),e.jsxs(r,{variant:"outline",size:"sm",onClick:()=>A(!M),className:"flex items-center gap-2",children:[e.jsx(g,{className:"h-4 w-4"}),"Hint"]})]}),M&&e.jsx("div",{className:"mt-4 p-4 bg-accent rounded-lg animate-slide-up",children:e.jsx("p",{className:"text-accent-foreground",children:G.hint})})]}),e.jsxs(a,{className:"space-y-4",children:[e.jsx("div",{className:"space-y-3",children:G.options.map((s,t)=>e.jsx("button",{onClick:()=>(async e=>{C(e),v&&await _(k,e)})(t),className:h("w-full p-4 text-left border rounded-lg transition-all duration-200 hover:border-primary",q===t?"border-primary bg-accent text-accent-foreground":"border-border bg-card"),children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:h("w-6 h-6 rounded-full border-2 flex items-center justify-center text-sm font-medium",q===t?"border-primary bg-primary text-primary-foreground":"border-muted-foreground"),children:String.fromCharCode(65+t)}),e.jsx("span",{children:s})]})},t))}),null!==q&&e.jsxs("div",{className:"pt-4",children:[e.jsxs(r,{variant:"outline",onClick:()=>P(!D),className:"mb-3",children:[D?"Hide":"Show"," Explanation"]}),D&&e.jsxs("div",{className:"p-4 bg-muted rounded-lg animate-slide-up",children:[e.jsx("h4",{className:"font-semibold mb-2",children:"Explanation:"}),e.jsx("p",{className:"text-muted-foreground",children:G.explanation})]})]}),e.jsxs("div",{className:"flex justify-between pt-6",children:[e.jsxs(r,{variant:"outline",onClick:()=>{k>0&&(E(k-1),A(!1),P(!1))},disabled:0===k,className:"flex items-center gap-2",children:[e.jsx(p,{className:"h-4 w-4"}),"Previous"]}),e.jsxs(r,{variant:"primary",onClick:()=>{k<y.length-1?(E(k+1),A(!1),P(!1)):$()},disabled:null===q,className:"flex items-center gap-2",children:[k===y.length-1?"Finish":"Next",k<y.length-1&&e.jsx(j,{className:"h-4 w-4"})]})]})]})]})]})});var R};
/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */export{v as default};
